# Base image with Node.js and ffmpeg
FROM node:18

# Install ffmpeg for video generation
RUN apt update && apt install -y ffmpeg

# Set working directory
WORKDIR /app

# Install global tools
RUN npm install -g n8n concurrently

# Clone the MCP GitHub repo
RUN git clone https://github.com/gyoridavid/short-video-maker.git mcp

# Set environment variables (or set via Railway UI)
ENV PEXELS_API_KEY=3tnRS1UdvzCQlQICXkw7NwP7pdSKbq6QflazbnlNXFN0I2D689Fb5nZ6
ENV N8N_BASIC_AUTH_ACTIVE=true
ENV N8N_BASIC_AUTH_USER=admin
ENV N8N_BASIC_AUTH_PASSWORD=admin123
ENV N8N_SECURE_COOKIE=false
ENV WEBHOOK_URL=https://your-app.up.railway.app

# Expose the ports
EXPOSE 5678
EXPOSE 3123

# Run both MCP and n8n
CMD ["npx", "concurrently", "n8n", "node mcp/index.js"]
